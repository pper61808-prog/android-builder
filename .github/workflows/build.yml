steps:
  - name: Checkout source
    uses: actions/checkout@v4

  - name: Set up JDK 17
    uses: actions/setup-java@v4
    with:
      java-version: '17'
      distribution: 'temurin'
      cache: gradle

  - name: Grant execute permission
    run: chmod +x gradlew

  # สร้าง Release APK (แบบยังไม่เซ็นชื่อ)
  - name: Build Release APK
    run: ./gradlew assembleRelease

  # ขั้นตอนการ Sign APK (เพื่อให้ติดตั้งบนมือถือได้จริง)
  - name: Sign APK
    uses: r0adkll/sign-android-release@v1
    id: sign_app
    with:
      releaseDirectory: app/build/outputs/apk/release
      signingKeyBase64: ${{ secrets.SIGNING_KEY }}
      alias: ${{ secrets.ALIAS }}
      keyStorePassword: ${{ secrets.KEY_STORE_PASSWORD }}
      keyPassword: ${{ secrets.KEY_PASSWORD }}
    env:
      BUILD_TOOLS_VERSION: "34.0.0"

  # อัปโหลดไฟล์ที่เซ็นชื่อแล้วขึ้น GitHub Artifacts
  - name: Upload Signed APK
    uses: actions/upload-artifact@v4
    with:
      name: signed-release-apk
      path: ${{ steps.sign_app.outputs.signedReleaseFile }}
